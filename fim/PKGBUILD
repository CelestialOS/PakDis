pkgname=fim
pkgver=0.4rc1
pkgrver=0.4-rc1
pkgrel=1
pkgdesc="improved framebuffer image viewer"
arch=('i686' 'x86_64')
url="http://savannah.gnu.org"
source=("http://download.savannah.gnu.org/releases/fbi-improved/$pkgname-$pkgrver.tar.bz2"
        "fim-0.4-libgif-5.1.patch")
md5sums=('SKIP' 'SKIP')
depends=("libgif" "libjpeg" "libpng")
makedepends=("g++" "bison" "flex" "perl")

prepare() {
  cd "$pkgname-$pkgrver"
  for i in src/FbiStuff.cpp src/FontServer.cpp src/fimgs doc/vim2html.pl; do
    echo "fixing paths in "$i
    sed -i -e "s/\/usr//g" -e "s/\/share\/consolefonts/\/share\/fonts\/console/g" $i
  done
  patch -p1 <../fim-0.4-libgif-5.1.patch
}

build() {
  cd "$pkgname-$pkgrver"
  ./configure --prefix=/ --disable-nls --disable-readline --enable-gif --enable-jpeg --enable-png
  make -j1
}

package() {
  cd "$pkgname-$pkgrver"
  make DESTDIR="$pkgdir" install
}
